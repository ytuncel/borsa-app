<script>
// index.html içindeki script kısmını bu şekilde güncelleyin
const tg = window.Telegram.WebApp;
tg.expand(); 

const urlParams = new URLSearchParams(window.location.search);
const selectedSymbol = urlParams.get('symbol') || 'AKBNK';

async function updateData() {
    // Ngrok linkinizi buraya tam yazın
    const baseUrl = "https://melodramatically-nonumbilical-sonya.ngrok-free.dev";
    const url = `${baseUrl}/get-data/${selectedSymbol}`; 

    try {
        const response = await fetch(url);
        if (!response.ok) throw new Error("Sunucu hatası");
        
        const data = await response.json();
        
        if(data.error) {
            console.log("API Hatası:", data.error);
            return;
        }

        document.getElementById('symbol').innerText = data.sembol;
        document.getElementById('price').innerText = data.fiyat + "₺";

        let html = "";
        const depth = data.derinlik.depth;
        // En fazla 10 satır göster
        for (let i = 0; i < 10; i++) {
            if(!depth.bids[i] && !depth.asks[i]) continue;
            html += `<tr>
                <td style="color:#8b949e">${depth.bids[i]?.quantity || '-'}</td>
                <td><span style="color:#3fb950; font-weight:bold">${depth.bids[i]?.price || '-'}</span> | <span style="color:#f85149; font-weight:bold">${depth.asks[i]?.price || '-'}</span></td>
                <td style="color:#8b949e">${depth.asks[i]?.quantity || '-'}</td>
            </tr>`;
        }
        document.getElementById('depth-table').innerHTML = html;
    } catch (e) {
        console.error("Bağlantı kesildi, tekrar deneniyor...", e);
    }
}

// 2 saniyede bir kesin güncelleme
setInterval(updateData, 2000);
updateData();
</script>
